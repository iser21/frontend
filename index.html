<script>
  const API_URL = "https://your-backend-name.onrender.com";

  const logList = document.getElementById("logList");
  const incidentList = document.getElementById("incidentList");

  document.getElementById("uploadForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const fileInput = document.getElementById("logFile");
    if (!fileInput.files[0]) return alert("Please select a .log file.");

    const formData = new FormData();
    formData.append("logFile", fileInput.files[0]);

    try {
      const res = await fetch(`${API_URL}/api/logs/upload`, {
        method: "POST",
        body: formData,
      });

      if (!res.ok) throw new Error("Upload failed");
      alert("‚úÖ Log uploaded and analyzed!");
      loadLogs();
      fetchIncidents();
    } catch (err) {
      alert("‚ùå Upload failed: " + err.message);
    }
  });

  async function loadLogs() {
    try {
      const res = await fetch(`${API_URL}/api/logs`);
      const logs = await res.json();

      if (logs.length === 0) {
        logList.innerHTML = `<li class="text-gray-400 italic">No logs found.</li>`;
      } else {
        logList.innerHTML = logs
          .map(log => `<li>${log.timestamp || ""} - ${log.message}</li>`)
          .join("");
      }
    } catch {
      logList.innerHTML = `<li class="text-red-400 italic">Error loading logs.</li>`;
    }
  }

  async function fetchIncidents() {
    const keyword = document.getElementById("search").value;
    const from = document.getElementById("from").value;
    const to = document.getElementById("to").value;

    const query = new URLSearchParams({ keyword, from, to }).toString();

    try {
      const res = await fetch(`${API_URL}/api/logs/incidents?${query}`);
      const data = await res.json();

      if (data.length === 0) {
        incidentList.innerHTML =
          "<li class='text-red-300 italic'>No incidents found.</li>";
        return;
      }

      incidentList.innerHTML = data
        .map(
          incident =>
            `<li>üî¥ [${new Date(incident.timestamp).toLocaleString()}] ${incident.message}</li>`
        )
        .join("");
    } catch {
      incidentList.innerHTML =
        "<li class='text-red-300 italic'>Error fetching incidents.</li>";
    }
  }

  window.onload = () => {
    loadLogs();
    fetchIncidents();
  };
</script>
